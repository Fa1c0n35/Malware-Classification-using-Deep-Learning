<template>
  <div class="content">
    <div class="md-layout">
      <div class="md-layout-item md-size-40">
        <div v-if="chartData_dist">
          <chartjs-card
            chart_id="dist_chart"
            :chartData="chartData_dist"
            :chartType="chartType_dist"
            :chartOptions="chartOptions_dist"
            :ifWantLabel="true"
          >
            <template slot="content">
              <center>
                <h4 class="title">Dataset Distribution</h4>
              </center>
            </template>
            <template slot="learn-more">
              <p>
                Pie chart above shows that all data distribution used for 
                training Denoising Autoencoders (DAE) are equal. This is done
                to prevent any imbalance classes that might affects the accuracy
                of generated signatures.
              </p>
            </template>
          </chartjs-card>
        </div>
      </div>
      <div class="md-layout-item md-size-60">
        <div v-if="chartData_umap">
          <chartjs-card
            chart_id="umap_chart"
            :chartData="chartData_umap"
            :chartType="chartType_umap"
            :chartOptions="chartOptions_umap"
            :chartWantZoom="true"
          >
            <template slot="content">
              <center>
                <h4 class="title">UMAP transformation on generated signatures</h4>
              </center>
            </template>
            <template slot="learn-more">
              <p>
                Above visual scatter plot shows that same malwares are likely to be
                <b>grouped together</b>, proving that same malware families' features
                are
                <b>likely to be identical among their variants</b>.
              </p>
              <p>
                All the data points above was generated using
                <i>Uniform Manifold Approximation and Projection (UMAP)</i> to
                <b>dimensionally reduce</b> signatures data which was originally
                <b>20-floating point numbers</b> to
                <b>2-dimensional numbers</b>
                which then can be visually plotted using standard XY scatter plot.
              </p>
            </template>
          </chartjs-card>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
import { ChartjsCard } from "@/components";
import axios from "axios";
import palette from "google-palette";

export default {
  components: {
    ChartjsCard
  },

  data() {
    return {
      chartData_dist: null,
      chartType_dist: "pie",
      chartOptions_dist: {
        animation: false
      },

      chartData_umap: null,
      chartType_umap: "scatter",
      chartOptions_umap: {
        animation: false
      }
    };
  },

  mounted() {
    var vm = this;

    axios.get("http://127.0.0.1:5000/trained-dataset-summary").then(function(response) {
      vm.chartData_dist = {
        labels: response.data.Label,
        datasets: [
          {
            data: response.data.Data,
            backgroundColor: vm.genColor("cb-Set2", response.data.Label.length)
          }
        ]
      };
    });

    axios.get("http://127.0.0.1:5000/get-umap-data").then(function(response) {
      var list_umap = [];
      var colors = vm.genColor("cb-Dark2", Object.keys(response.data).length);

      var i = 0;
      for (var k in response.data) {
        list_umap.push({
          label: k,
          backgroundColor: colors[i++],
          data: response.data[k]
        });
      }

      vm.chartData_umap = {
        datasets: list_umap
      };
    });
  },

  methods: {
    genColor(name, count) {
      var colors = palette(name, count);
      for (var i = 0; i < colors.length; i++) {
        colors[i] = "#" + colors[i];
      }
      return colors;
    }
  }
};
</script>
