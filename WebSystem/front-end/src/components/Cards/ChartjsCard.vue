<template>
  <md-card>
    <md-card-header class="card-chart">
      <div class="canvas_wrapper">
        <canvas :id="chart_id"></canvas>
      </div>
    </md-card-header>
    <md-card-content>
      <slot name="content"></slot>
    </md-card-content>
    <md-card-expand v-if="hasLearnMoreSlot">
      <md-card-actions md-alignment="right">
        <md-card-expand-trigger>
          <md-button class="md-info">Learn more</md-button>
        </md-card-expand-trigger>
      </md-card-actions>
      <md-card-expand-content>
        <md-card-content>
          <slot name="learn-more"></slot>
        </md-card-content>
      </md-card-expand-content>
    </md-card-expand>
  </md-card>
</template>

<script>
import Chart from "chart.js";
import zoom from "chartjs-plugin-zoom";

export default {
  name: "chartjs-card",
  props: {
    chart_id: {
      type: String,
      default: "chart_id"
    },
    chartType: {
      type: String,
      default: "bar"
    },
    chartData: {
      type: Object,
      default: () => {
        return {
          labels: ["Red", "Blue", "Yellow", "Green", "Purple", "Orange"],
          datasets: [
            {
              label: "# of Votes",
              data: [12, 19, 3, 5, 2, 3],
              backgroundColor: [
                "rgba(255, 99, 132, 0.2)",
                "rgba(54, 162, 235, 0.2)",
                "rgba(255, 206, 86, 0.2)",
                "rgba(75, 192, 192, 0.2)",
                "rgba(153, 102, 255, 0.2)",
                "rgba(255, 159, 64, 0.2)"
              ],
              borderColor: [
                "rgba(255,99,132,1)",
                "rgba(54, 162, 235, 1)",
                "rgba(255, 206, 86, 1)",
                "rgba(75, 192, 192, 1)",
                "rgba(153, 102, 255, 1)",
                "rgba(255, 159, 64, 1)"
              ],
              borderWidth: 1
            }
          ]
        };
      }
    },
    chartOptions: {
      type: Object,
      default: () => {}
    },
    chartWantZoom: {
      type: Boolean,
      default: false
    },
    chartHeight: {
      type: Number,
      default: 0
    }
  },
  data() {
    return {
      chartObj: null
    };
  },
  computed: {
    hasLearnMoreSlot() {
      return !!this.$slots["learn-more"];
    }
  },
  mounted() {
    if (this.chartWantZoom) {
      this.chartOptions.pan = {
        enabled: true,
        mode: "xy"
      };

      this.chartOptions.zoom = {
        enabled: true,
        mode: "xy"
      };
    }

    if (this.chartHeight > 0) {
      this.chartOptions.responsive = true;
      this.chartOptions.maintainAspectRatio = false;
      document.querySelector(".canvas_wrapper").style.height = this.chartHeight + "px";
    }

    this.chartObj = new Chart(this.chart_id, {
      type: this.chartType,
      data: this.chartData,
      options: this.chartOptions
    });
  }
};
</script>
